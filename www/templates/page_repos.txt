{capture assign="page_title"}Repos{/capture}
{include file="inc_head.txt"}

{if $error_rsp}

<div class="container">
<h2>The computers are SAD and CRANKY...</h2>

<p>This is what they said: <code>{$error_rsp.error|@escape}</code></p>
</div>

{else}

<div class="container">

{if $rows|@count}

<table class="table" style="margin-top:2em;">

<tr>
	<th>Repo</th>
	<th>Status</th>
	<th>Debug</th>
	<th>Updated</th>
</tr>

{foreach from=$rows item="row"}
<tr>
	<td><a href="{$cfg.abs_root_url}repos/?repo={$row.repo|@escape}">{$row.repo|escape}</a></td>
	<td>{$row.status|escape}</td>
	<td>{if $row.debug}<a href="#" class="debug" data-id="{$row.id|escape}">show debug</a>{/if}</td>
	<td>{$row.updated|escape}</td>
</tr>
<tr>
	{* basically this is the only way to prevent the 'pre' block generated by dumper from being rendered *}
	{* as a table cell with a colspan of 1... dunno... (20160429/thisisaaronland) *}
	<td colspan="6" style="padding: 0; border: none;"><span id="debug-{$row.id|@escape}" class="hidden"><pre style="margin: 0;">{$row.debug|escape}</pre></span></td>
</tr>
{/foreach}

</table>

{include file="inc_pagination.txt"}

{/if}

<script type="text/javascript">{literal}

$(document).ready(function(){

	$('a.debug').click(function(e) {
		e.preventDefault();
		var id = $(e.target).data('id');
		$('#debug-' + id).toggleClass('hidden');
	});

});

{/literal}</script>
</div>

{/if}

{include file="inc_foot.txt"}
